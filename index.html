<script>
    async function loadData() {
        try {
            const res = await fetch('recommendations.json?t=' + Date.now());
            if (!res.ok) throw new Error("File not found");
            const data = await res.json();
            
            // 안전하게 데이터 넣기 (데이터가 없으면 기본값 표시)
            document.getElementById('update-date').innerText = data.date || "날짜 정보 없음";
            document.getElementById('summary').innerText = data.summary || "데이터를 불러오는 중입니다...";
            document.getElementById('reason').innerText = "Insight: " + (data.reason || "상세 분석 준비중");

            // 지수 렌더링
            if (data.market_info) {
                document.getElementById('market-grid').innerHTML = Object.entries(data.market_info).map(([name, info]) => `
                    <div class="glass p-3 rounded-2xl">
                        <div class="flex justify-between items-start mb-1">
                            <span class="text-[10px] text-slate-400 font-bold">${name}</span>
                            <span>${info.status}</span>
                        </div>
                        <div class="text-lg font-black">${info.price}</div>
                        <div class="text-xs ${info.change >= 0 ? 'text-red-400' : 'text-blue-400'}">${info.change >= 0 ? '▲' : '▼'} ${info.change}%</div>
                    </div>
                `).join('');
            }

            // 추천 종목
            if (data.tickers) {
                document.getElementById('ticker-list').innerHTML = data.tickers.map(t => `
                    <div class="flex-1 bg-slate-700/50 border border-slate-600 rounded-xl p-3 text-center">
                        <span class="text-sm font-bold text-yellow-400">${t}</span>
                    </div>
                `).join('');
            }

            // 뉴스 렌더링 (구조 확인 후 안전하게)
            if (data.news_headlines) {
                document.getElementById('news-container').innerHTML = data.news_headlines.map(news => `
                    <a href="${news.link || '#'}" target="_blank" class="block p-3 rounded-xl bg-slate-800/50 border border-slate-700 hover:bg-slate-700/50 transition-all">
                        <p class="text-xs text-slate-300 font-medium">${news.title || "제목 없음"}</p>
                    </a>
                `).join('');
            }

            // 어제 결과 및 히스토리 (동일)
            // ... (중략 - 기존 스크립트와 동일하지만 try-catch로 감싸져 있음)
        } catch (e) {
            console.error("데이터 로드 중 오류:", e);
            document.getElementById('summary').innerHTML = "<span class='text-red-400'>데이터를 불러올 수 없습니다. GitHub Actions 실행이 완료되었는지 확인해주세요.</span>";
        }
    }
    loadData();
</script>
